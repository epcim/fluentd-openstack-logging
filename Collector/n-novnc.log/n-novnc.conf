# TIMESTAMP {date time} LEVEL  API   [] MESSAGE

<source>
    type tail
    path /opt/stack/logs/n-novnc.log

    format grok
    grok_pattern %{NOVANOVNC}
    custom_pattern_path /home/safiyat/GitHub/fluentd-openstack-logging/GrokPatterns/pattern

    tag nova.novnc
</source>

<filter nova.novnc>
    type record_transformer
    enable_ruby
    <record>
        host ${hostname}
        # component ${tag_parts[0]}
        subcomponent ${tag_parts[1]}
        request ${request.gsub!("\u001b".encode('utf-8'), "");request.gsub(/\[0[0-2](;[0-9]{2})?m/, '')}
        # clientid ${clientid.gsub!("\u001b".encode('utf-8'), "");clientid.gsub(/\[0[0-2](;[0-9]{2})?m/, '')}
        # tenantid ${tenantid.gsub!("\u001b".encode('utf-8'), "");tenantid.gsub(/\[0[0-2](;[0-9]{2})?m/, '')}
        message ${message.gsub!("\u001b".encode('utf-8'), "");message.gsub(/\[0[0-2](;[0-9]{2})?m/, '')}
        timestamp ${timestamp.gsub!(" ", "T");timestamp.gsub(/\.\d*/, "+05:30")}      # 2015-11-04T13:54:44+05:30
    </record>
</filter>

<match nova.novnc>
    type retag
    add_prefix output.controller
</match>

###############################################################################
###############################################################################
###############################################################################

<match output.**>
    type stdout
</match>
