<source>
    type tail
    path /var/log/apache2/access.log
    pos_file /tmp/apache2--access.log.pos
    format /(?<client>(\S+))\s+(?<request>(\S+))\s+(?<userid>(\S+))\s+\[(?<timestamp>([^\]]+))\]\s+"(?<method>([A-Z]+))\s+(?<url>(\S*))[^"]*"\s+(?<statuscode>(\d+))\s+(?<size>(\d+))\s+"(?<referrer>([^"]*))"\s+"(?<useragent>([^"]*))"/
    tag apache2.access
    log_level info
</source>

<filter apache2.access>
    type record_transformer
    enable_ruby
   <record>
        host ${hostname}
        subcomponent ${tag_parts[1]}
        timestamp ${require 'time';Time.strptime(timestamp, "%d/%b/%Y:%H:%M:%S %z").strftime("%Y-%m-%dT%H:%M:%S%:z")}
   </record>
</filter>

<match apache2.access>
    type retag
    add_prefix output.connet
</match>
