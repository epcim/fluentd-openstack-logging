<source>
    type tail
    path /var/log/neutron/neutron-metadata-agent.log
    pos_file /tmp/neutron-metadata-agent.log.pos
    format multiline
    format_firstline /(?>\d\d){1,2}-(?>\d*)-(?>\d*)\s*(?>\d*):(?>\d*):(?>\d*)\.(?>\d*)\s*(?>\d*)\s*(?>\S*)\s*(?>\S*)\s*\[(?>[^\]])\]\s*(?>.*)/
    format1 /(?<timestamp>(?>\d\d){1,2}-(?>\d*)-(?>\d*)\s*(?>\d*):(?>\d*):(?>\d*)\.(?>\d*))\s*(?<pid>(?>\d*))\s*(?<loglevel>(?>\S*))\s*(?<api>(?>\S*))\s*\[(?<requestID>(?>[^\]]))\]\s*(?<message>(?>.*))/
    tag neutron.metadata
    log_level info
</source>

<filter neutron.metadata>
    type record_transformer
    enable_ruby
   <record>
        host ${hostname}
        subcomponent ${tag_parts[1]}
        timestamp ${timestamp.gsub!(" ", "T");timestamp.gsub(/\.\d*/, "+05:30")}
   </record>
</filter>

<match neutron.metadata>
    type retag
    add_prefix output.connet
</match>
